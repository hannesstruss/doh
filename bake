#!/bin/bash

REGISTRY=doh64.local:5000

set -e

case $1 in
  build)
    (cd analyzer; docker buildx build -t $REGISTRY/doh/analyzer --platform linux/arm64,linux/amd64 --push .)
    (cd dohkt; ./gradlew :app:distZip && docker buildx build -t $REGISTRY/doh/app --push .)
    ;;

  run)
    docker-compose -f docker-compose.yml -f docker-compose.dev.yml up
    ;;
esac
